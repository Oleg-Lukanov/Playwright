# Project Title

## Summary

This repository contains end-to-end tests for [https://www.redmine.org/] using Playwright. The tests are automated through GitHub Actions, and test reports are generated using Allure and deployed to GitHub Pages.

## Requirements

- Node.js (>= 16.x)
- npm (>= 6.x)
- Playwright
- Allure CLI

## Steps to Install

1. **Clone the repository**:
    ```bash
    git clone https://github.com/your-username/your-repo.git
    cd your-repo
    ```

2. **Install dependencies**:
    ```bash
    npm install
    ```

3. **Install Playwright browsers**:
    ```bash
    npx playwright install
    ```

## Steps to Launch

1. **Run Playwright tests**:
    ```bash
    npx playwright test
    ```

2. **View Allure report locally**:
    ```bash
    npx allure generate ./allure-results --clean
    npx allure open ./allure-report
    ```

## Steps to Creating the Report

The Allure report is generated and deployed by GitHub Actions. Follow the steps below to ensure the pipeline is set up correctly.

### GitHub Actions Workflow

1. **Create GitHub Actions workflow file**:
    - Create `.github/workflows/playwright-allure.yml` with the following content:

    ```yaml
    name: Playwright Tests

    on:
      push:
        branches:
          - main
      pull_request:

    jobs:
      test:
        runs-on: ubuntu-latest

        steps:
          - name: Checkout code
            uses: actions/checkout@v3

          - name: Set up Node.js
            uses: actions/setup-node@v3
            with:
              node-version: '16'

          - name: Install dependencies
            run: npm install

          - name: Run Playwright tests
            run: npx playwright test

          - name: Copy Allure results from previous runs
            run: |
              mkdir -p ./previous-allure-results
              if git ls-remote --exit-code --heads origin allure-results; then
                git fetch origin allure-results:allure-results
                git checkout allure-results
                cp -R ./allure-report/* ./previous-allure-results
                git checkout -
              fi

          - name: Generate Allure report
            run: npx allure generate ./allure-results ./previous-allure-results --clean

          - name: Copy Allure results to allure-results branch
            run: |
              git config --global user.email "oleeluk@gmail.com"
              git config --global user.name "Oleh_Lukianchuk"
              git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}
              git fetch origin
              git checkout -B allure-results
              cp -R ./allure-report/* .
              git add .
              git commit -m "Update Allure report"
              git push origin allure-results --force

          - name: Deploy to GitHub Pages
            uses: peaceiris/actions-gh-pages@v3
            with:
              github_token: ${{ secrets.GITHUB_TOKEN }}
              publish_dir: ./allure-report
              publish_branch: gh-pages

          - name: Update GitHub Pages link in README
            run: |
              REPORT_LINK="https://${{ github.Oleg-Lukanov }}.github.io/${{ github.playwright-framework }}"
              sed -i "s|Allure Report|Allure Report: [View Report](${REPORT_LINK})|" README.md
              git add README.md
              git commit -m "Update Allure Report link in README"
              git push origin main
    ```

2. **Set up Secrets on GitHub**:
    - Navigate to your repository on GitHub.
    - Go to `Settings` > `Secrets and variables` > `Actions`.
    - Click on `New repository secret`.
    - Add the following secret:
      - **Name**: `GITHUB_TOKEN`
      - **Value**: The token is automatically generated by GitHub and does not need to be manually added.

3. **Commit and push the workflow file**:
    ```bash
    git add .github/workflows/playwright-tests.yml
    git commit -m "Add Playwright tests workflow"
    git push origin main
    ```

4. **Trigger the workflow**:
    - The workflow is triggered on push to the `main` branch or on pull requests. Push a change to the `main` branch to start the workflow.

### View the Allure Report

The Allure report is deployed to GitHub Pages and can be accessed at:
[Allure Report: View Report](https://Oleg-Lukanov.github.io/playwright-framework)

---

This `README.md` file provides a comprehensive guide on how to set up and use the repository, including running tests and generating reports, and ensures that anyone reading it can understand and follow the instructions without needing additional context.
